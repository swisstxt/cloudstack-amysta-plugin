(function (cloudStack) {
  cloudStack.plugins.amystaPlugin = function(plugin) {
    plugin.ui.addSection({
      id: 'amystaPlugin',
      title: 'Billing',
      preFilter: function(args) {
        return true;
      },
      show: function() {
        var amysta_domain = 'https://ma-cloud.swisstxt.ch';
        var amysta_path = '/billing';
	var session_id = $.cookie("JSESSIONID");
        var amysta_url = amysta_domain + amysta_path + '?jsessionid=' + session_id /* + '&sessionkey=' + g_sessionKey;*/
        var iframe_source = '<iframe src="' + amysta_url + '" height="675" width="794" scrolling="auto">';
        var $iframe = $(iframe_source);
	console.log( $.cookie("JSESSIONID") );
	console.log(amysta_url);
	window.open()
        window.addEventListener('message', function(event) {
          if (event.origin !== amysta_domain) return;
          if (event.data !== 'logout') return;
          cloudStack.dialog.notice({ message: "Session expired.", clickAction: function() {
            g_loginResponse = null;
            document.location.reload();
          }
          });
        }, false);
        return $iframe;
      }
    });
  };
}(cloudStack));
